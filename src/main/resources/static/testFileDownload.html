<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Download</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.18.9/babel.min.js"></script>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState } = React;

    const FileDownload = () => {
        const [fileId, setFileId] = useState("");
        const [message, setMessage] = useState("");

        const handleDownload = () => {
            if (!fileId) {
                setMessage("Please enter a file ID.");
                return;
            }

            // Construct the URL with fileId as a query parameter
            const apiUrl = `http://localhost:8081/api/files/downloadFile?fileId=${fileId}`;

            // Send GET request with the fileId as a query parameter
            fetch(apiUrl)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("File not found or server error");
                    }

                    // Get the filename from the response headers
                    const disposition = response.headers.get('Content-Disposition');
                    let filename = "downloaded-file"; // default filename
                    console.log("Disposition Header:", disposition);

                    if (disposition && disposition.indexOf('attachment') !== -1) {
                        const matches = /filename="([^;]+)"/.exec(disposition);
                        if (matches != null && matches[1]) {
                            filename = matches[1]; // Extract filename
                        }
                    }

                    return response.blob().then((blob) => ({ blob, filename }));
                })
                .then(({ blob, filename }) => {
                    // Create a link element to download the file
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.style.display = "none";
                    a.href = url;
                    a.download = filename;  // Use the filename from headers or default one
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);

                    setMessage("Download started.");
                })
                .catch((error) => {
                    setMessage(`Error: ${error.message}`);
                });
        };

        return (
            <div>
                <h1>Download File</h1>
                <input
                    type="number"
                    placeholder="Enter File ID"
                    value={fileId}
                    onChange={(e) => setFileId(e.target.value)}
                />
                <button onClick={handleDownload}>Download</button>
                {message && <p>{message}</p>}
            </div>
        );
    };

    ReactDOM.render(<FileDownload />, document.getElementById("root"));
</script>
</body>
</html>
